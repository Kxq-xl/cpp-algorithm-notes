# 1. 操作系统概述

## 1.1 操作系统的基本概念

###  1.1.1 操作系统的概念

**操作系统是计算机的“管理者”和“中介”**，它负责协调和控制计算机的各种资源（如 CPU、内存、硬盘、输入输出设备等），同时向上为用户和程序提供一个**友好、统一的操作接口**。

**常见功能包括：**

1. **进程管理**：
    管理程序的运行，包括进程创建、调度、终止等。
2. **内存管理**：
    控制和分配内存资源，确保各程序合理使用内存，互不干扰。
3. **文件系统**：
    提供文件的创建、读写、存储等功能，便于数据管理。
4. **设备管理**：
    管理各种输入输出设备，如硬盘、打印机、键盘等。
5. **用户接口**：
    提供命令行或图形界面，让用户能与计算机交互。

常见的操作系统有: **Windows ** **Linux ** **macOS ** **Android / iOS（移动设备）**

### 1.1.2 操作系统的功能和目标

操作系统作为计算机系统资源的管理者

- 处理机管理
- 存储器管理
- 文件管理
- 设备管理

![image-20250807183551941](https://cdn.jsdelivr.net/gh/Kxq-xl/pic-bed/img/image-20250807183551941.png)

![image-20250807185430547](https://cdn.jsdelivr.net/gh/Kxq-xl/pic-bed/img/image-20250807185430547.png)

### 1.1.3 操作系统的特征

操作系统的特称： 并发 ，共享，虚拟，异步。

- **并发:**  指两个或者多个事件在同一时间间隔内发生，这些事件**宏观上是同时发生的**，但**微观上是交替发生的**。并行：是指两个时间在同一时刻同时发生。

![image-20250807191349209](https://cdn.jsdelivr.net/gh/Kxq-xl/pic-bed/img/image-20250807191349209.png)

**注意:**

单核CPU**同一时刻只能执行一个程序**，各个程序**并发**的执行。

多核CPU**同一时刻能执行多个程序**，多个程序可以**并行**执行。

- **共享**：共享即多个事件发生的时候，共同使用。资源共享主要分为**互斥共享**和**同时共享**。

微信和qq不能同时视频，这个就是互斥共享，不能同时占用摄像头。

但是可以同时发送文件，同时发送文件在宏观上是同时读取，同时发送，但并不是同时共享，它在微观上，两个进程是交替着访问硬盘的，这里传一会儿，那里传一下。所以磁盘是可共享资源，但访问是以并发+交替调度方式进行的

我们如果一遍打游戏，一遍听歌，这个扬声器确实是同时共享

**并发和共享是互为存在的条件**，只有并发了你才可以共享，你共享了，就必须并发才行。

- **虚拟： **把一个物理上的实体变为若干个逻辑上的对应物。物理实体(前者)是实际存在的，而逻辑上对应物（后者）是用户感受到的。

比如4g的内存，但你却能打开好多程序，他们运行内存远远大于4gb，这就是虚拟存储器技术。实际上只有4g，但用户看起来很大。 ------ 空分复用技术。

比如我们一个单核的CPU，物理上我们只能打开一个程序，但是逻辑上我们仍然可以打开很多很多的程序。 ----- 时分复用技术。

 ![image-20250807194931611](https://cdn.jsdelivr.net/gh/Kxq-xl/pic-bed/img/image-20250807194931611.png)

- **异步：**在多道程序环境下，允许多个程序并发执行，但由于资源有限，进程的执行不是一贯到底的，而是走走停停，以不可预知的速度向前推进，这就是进程的异步性。

你需要打印文档A和B, 总有个先后，先打印A B则等待，系统资源有限，因此进程的执行不是一贯到底的。

## 1.2 操作系统的发展与分类

![image-20250808153041562](https://cdn.jsdelivr.net/gh/Kxq-xl/pic-bed/img/image-20250808153041562.png)

## 1.3 操作系统的运行环境

### 1.3.1 操作系统的运行机制

在操作系统中，cpu上会运行两种程序，一种是操作系统的**内核程序**，另一种是用户编写的**应用程序**。

**两种指令:**

- 特权指令: 是指不允许用户直接使用的指令，I/O指令，内存清零，修改程序状态寄存器等指令
- 非特权指令: 用户可以直接使用的指令，它不能直接访问系统的软硬件资源，防止破坏系统。

两种处理器状态：

- 内核态：运行的是内核程序，此时可以执行特权指令

- 用户态： 运行的是应用程序，只能执行非特权指令。

CPU中有一个寄存器叫做程序状态字寄存器(psw) 其中有一个二进制位，`1`表示内核态` 0`表示用户态。有些 CPU 设计是反过来的（比如 `0` 表示内核态，`1` 表示用户态），**具体取值要看 CPU 架构手册**。

![image-20250808161040012](https://cdn.jsdelivr.net/gh/Kxq-xl/pic-bed/img/image-20250808161040012.png)

### 1.3.2 中断和异常

在合适的情况下，操作系统内核会把cpu的使用权主动让给应用程序。

中断是让操作系统给内核夺回cpu使用权的**唯一途径**，中断会使cpu由用户态变为内核态。

中断分为**内中断（异常）**和**外中断**

- 内中断: 与当前执行的指令有关，中断信号来源于cpu内部。

试图在用户态下执行特权指令，当前的指令是非法的(**终止**)，或者参数是非法的(**故障**)。

应用程序想请求操作系统内核服务，此时会执行一条**陷入指令**，该指令会引发一个内部中断信号，**系统调用就是通过陷入指令完成的**。

- 外中断: 与当前执行的指令无关，中断信号来源于cpu外部。

时钟中断，I/O中断。

![image-20250808170047574](https://cdn.jsdelivr.net/gh/Kxq-xl/pic-bed/img/image-20250808170047574.png)

### 1.3.3 系统调用

系统调用是操作系统提供给程序(程序员)使用的接口。

系统调用的功能:

- 设备管理
- 文件管理
- 进程控制
- 进程通信
- 内存管理

![image-20250808172557614](https://cdn.jsdelivr.net/gh/Kxq-xl/pic-bed/img/image-20250808172557614.png)

![image-20250808172624360](https://cdn.jsdelivr.net/gh/Kxq-xl/pic-bed/img/image-20250808172624360.png)

## 1.4 操作系统体系结构

操作系统的体系结构有大内核(宏内核)，微内核，分层结构，模块化，外核。

- 分层结构： 每层单向调用更低一层所提供的接口，便于调试，易维护，但是效率低，不可跨层调用，效率低。
- 模块化：每个模块之间相互独立，有着清晰的结构，但是模块之间可能会出现相互调用的情况，一旦出了问题，调试和验证会有点麻烦。
- 大内核:  高性能，但是结构混乱，难以维护
- 微内核： 内核功能少，方便维护，但是多次状态切换，性能低。
- 外核: 可以直接给用户进程分配不虚拟不抽象的硬件资源，使用户进程更灵活的使用硬件资源，但它降低了系统的一致性，使系统变得复杂。

![image-20250811174934154](https://cdn.jsdelivr.net/gh/Kxq-xl/pic-bed/img/image-20250811174934154.png)

![image-20250811175156226](https://cdn.jsdelivr.net/gh/Kxq-xl/pic-bed/img/image-20250811175156226.png)

## 1.5 操作系统的引导

计算机中的主存由RAM(内存)和ROM组成。

| 对比项       | RAM（内存）              | ROM（只读存储器）                |
| ------------ | ------------------------ | -------------------------------- |
| 是否可写     | 读写都行（运行时可改）   | 一般只读（某些可擦写）           |
| 断电是否丢失 | 丢失（易失性）           | 不丢失（非易失性）               |
| 速度         | 很快                     | 较慢                             |
| 主要用途     | 存放正在运行的程序和数据 | 存放启动程序和固件(BIOS)自举程序 |
| 位置         | 内存条8G, 16G 32G        | 焊在主板上的芯片                 |

开机通电，cpu去找主存，然后里面的ROM引导程序会指示cpu去磁盘首位置将主引导记录和分区表读入到RAM(内存中去) 

然后cpu执行磁盘引导程序，然后根据分区表，去判断C盘所处的位置，然后在C盘中找到引导记录PBR，它会负责找到启动管理，在根目录下找到启动管理程序，然后就会完成操作系统初始化的工作。

![image-20250811194744778](https://cdn.jsdelivr.net/gh/Kxq-xl/pic-bed/img/image-20250811194744778.png)

## 1.6 虚拟机

![image-20250812105818489](https://cdn.jsdelivr.net/gh/Kxq-xl/pic-bed/img/image-20250812105818489.png)

